{{/* ID duy nhất cho slider này */}}
{{ $id := printf "slider-%d" now.Unix }}

<div id="{{ $id }}" class="slider" style="max-width: {{ with .Get "width" }}{{ . }}{{ else }}100%{{ end }};">
  {{ with .Get "dir" }}
    {{ $dir := . }}
    {{ $images := readDir (printf "static/%s" $dir) }}

    {{/* DÙNG $.Get vì đang ở trong with */}}
    {{ $height := $.Get "height" | default "420px" }}
    {{ $fit := $.Get "fit" | default "cover" }}
    {{ $position := $.Get "position" | default "center" }}
    {{ $radius := $.Get "radius" | default "12px" }}
    {{ $gap := $.Get "gap" | default "0px" }}

    <button class="prev-btn" aria-label="Previous">&lt;</button>
    <div class="slider-track" style="gap: {{ $gap }};">
      {{ range $index, $file := $images }}
        {{ if or (strings.HasSuffix $file.Name ".jpg") (strings.HasSuffix $file.Name ".png") (strings.HasSuffix $file.Name ".webp") (strings.HasSuffix $file.Name ".gif") }}
          <img
            src="{{ printf "/%s/%s" $dir $file.Name }}"
            alt="{{ $file.Name }}"
            loading="lazy"
            class="slide"
            style="
              height: {{ $height }};
              object-fit: {{ $fit }};
              object-position: {{ $position }};
              border-radius: {{ $radius }};
            "
          >
        {{ end }}
      {{ end }}
    </div>
    <button class="next-btn" aria-label="Next">&gt;</button>
  {{ end }}
</div>

<style>
  .slider { position: relative; width: 100%; overflow: hidden; text-align: center; }
  .slider-track { display: flex; width: 100%; transition: transform 0.5s ease; will-change: transform; }
  .slide { min-width: 100%; width: 100%; height: auto; }
  .prev-btn, .next-btn {
    position: absolute; top: 50%; transform: translateY(-50%);
    background: rgba(0,0,0,.5); color: #fff; border: none;
    width: 34px; height: 34px; line-height: 34px; font-size: 20px;
    cursor: pointer; z-index: 10; border-radius: 999px; user-select: none;
  }
  .prev-btn { left: 10px; } .next-btn { right: 10px; }
  .prev-btn:hover, .next-btn:hover { background: rgba(0,0,0,.8); }
</style>

<script>
(function() {
  const root = document.getElementById("{{ $id }}");
  if (!root) return;

  const track = root.querySelector(".slider-track");
  const slides = root.querySelectorAll(".slide");
  const prevBtn = root.querySelector(".prev-btn");
  const nextBtn = root.querySelector(".next-btn");

  // Không làm gì nếu không có ảnh
  if (!slides || slides.length === 0) return;

  let current = 0;

  function go(i) {
    current = (i + slides.length) % slides.length;
    track.style.transform = "translateX(-" + (current * 100) + "%)";
  }

  // Ẩn nút & tắt auto-slide nếu chỉ có 1 ảnh
  if (slides.length < 2) {
    prevBtn.style.display = "none";
    nextBtn.style.display = "none";
  } else {
    prevBtn.addEventListener("click", () => go(current - 1));
    nextBtn.addEventListener("click", () => go(current + 1));

    let timer = setInterval(() => go(current + 1), 3000);
    track.addEventListener("mouseenter", () => clearInterval(timer));
    track.addEventListener("mouseleave", () => { timer = setInterval(() => go(current + 1), 3000); });
  }

  // Đảm bảo bắt đầu ở vị trí 0
  go(0);
})();
</script>
